{# ======================================== #}
{# TEMPLATE: view_post.html                #}
{# PURPOSE: Display a single blog post     #}
{# EXTENDS: base.html                      #}
{# ======================================== #}

{# Extend the base template for consistent layout and styling #}
{% extends "base.html" %}

{# Set the page title using the post title - this appears in the browser tab #}
{% block title %}{{ post.title }} - BlogSpace{% endblock %}

{# Main content block - everything inside this will be inserted into base.html #}
{% block content %}

{# ======================================== #}
{# BREADCRUMB NAVIGATION                   #}
{# ======================================== #}
{# Navigation breadcrumbs help users know where they are in the site #}
{# Each breadcrumb is a clickable link except the current page #}
<nav class="mb-6">
    <ol class="flex items-center space-x-2 text-sm text-gray-600">
        {# Home link - always visible #}
        <li><a href="{{ url_for('index') }}" class="hover:text-blog-600 transition-colors">Home</a></li>
        <li><span class="mx-2">/</span></li>
        {# Posts list link #}
        <li><a href="{{ url_for('posts') }}" class="hover:text-blog-600 transition-colors">Posts</a></li>
        <li><span class="mx-2">/</span></li>
        {# Current post title (truncated to 30 characters) #}
        {# The |length filter gets the string length, then we use if/endif for conditional display #}
        <li class="text-gray-800 font-medium">{{ post.title[:30] }}{% if post.title|length > 30 %}...{% endif %}</li>
    </ol>
</nav>

{# ======================================== #}
{# MAIN CONTENT GRID LAYOUT                #}
{# ======================================== #}
{# This creates a responsive grid: 1 column on mobile, 4 columns on large screens #}
{# The main content takes 3 columns, sidebar takes 1 column #}
<div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
    
    {# ======================================== #}
    {# MAIN CONTENT AREA (3 columns)           #}
    {# ======================================== #}
    {# This div contains the post content, comments, and main features #}
    <div class="lg:col-span-3">
        
        {# ======================================== #}
        {# POST HEADER SECTION                    #}
        {# ======================================== #}
        {# Contains category, title, author info, and post metadata #}
        <header class="mb-8">
            
            {# ======================================== #}
            {# CATEGORY BADGE                        #}
            {# ======================================== #}
            {# Only show category badge if the post has a category #}
            {# This is a conditional block using Jinja if/endif syntax #}
            {% if post.category_name %}
            <div class="inline-block bg-blog-100 text-blog-700 text-sm font-semibold px-4 py-2 rounded-full mb-4">
                {# Display the category name from the database #}
                {{ post.category_name }}
            </div>
            {% endif %}
            
            {# ======================================== #}
            {# POST TITLE                            #}
            {# ======================================== #}
            {# The main heading of the post - uses custom font and responsive sizing #}
            <h1 class="text-4xl md:text-5xl font-display font-bold text-gray-800 mb-6 leading-tight">
                {# Display the post title from the database #}
                {{ post.title }}
            </h1>
            
            {# ======================================== #}
            {# DRAFT STATUS INDICATOR                 #}
            {# ======================================== #}
            {# Show draft badge if post is not published #}
            {# This helps authors identify their draft posts #}
            {% if post.status == 'draft' %}
            <div class="inline-block bg-yellow-100 text-yellow-700 text-sm font-semibold px-4 py-2 rounded-full mb-6">
                üìù This is a draft post - only you can see it
            </div>
            {% endif %}
            
            {# ======================================== #}
            {# FEATURED IMAGE                         #}
            {# ======================================== #}
            {# Display featured image if one exists #}
            {% if post.featured_image %}
            <div class="mb-6">
                <img src="{{ url_for('static', filename=post.featured_image) }}" 
                     alt="Featured image for {{ post.title }}"
                     class="w-full h-64 md:h-80 lg:h-96 object-cover rounded-2xl shadow-lg">
            </div>
            {% endif %}
            
            {# ======================================== #}
            {# POST META INFORMATION                #}
            {# ======================================== #}
            {# Contains author info, post stats, and action buttons #}
            {# Uses flexbox for responsive layout - stacks on mobile, side-by-side on larger screens #}
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
                
                {# ======================================== #}
                {# AUTHOR INFORMATION                   #}
                {# ======================================== #}
                <div class="flex items-center space-x-4">
                    {# Author avatar and details #}
                    <div class="flex items-center space-x-3">
                        {# Author avatar - circular gradient background with first letter of username #}
                        <div class="w-12 h-12 bg-gradient-to-br from-blog-500 to-blog-600 rounded-full flex items-center justify-center">
                            {# Get first character of author name and convert to uppercase #}
                            {# post.author_name[0] gets first character, .upper() makes it uppercase #}
                            <span class="text-white text-lg font-bold">{{ post.author_name[0].upper() }}</span>
                        </div>
                        {# Author name and bio #}
                        <div>
                            {# Display full author name #}
                            <p class="font-semibold text-gray-800">{{ post.author_name }}</p>
                            {# Only show bio if it exists - conditional rendering #}
                            {% if post.author_bio %}
                            <p class="text-sm text-gray-600">{{ post.author_bio }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {# ======================================== #}
                {# POST STATISTICS                      #}
                {# ======================================== #}
                {# Shows creation date and view count #}
                <div class="flex items-center space-x-6 text-sm text-gray-500">
                    {# Creation date with calendar icon #}
                    <div class="flex items-center space-x-2">
                        {# SVG icon for calendar #}
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        {# Display creation date with fallback to 'Recently' if no date #}
                        {# This uses Jinja's if/else syntax: value if condition else fallback #}
                        <span>{{ post.created_at if post.created_at else 'Recently' }}</span>
                    </div>
                    {# View count with eye icon #}
                    <div class="flex items-center space-x-2">
                        {# SVG icon for eye/views #}
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                        {# Display view count from database #}
                        <span>{{ post.view_count }} views</span>
                    </div>
                </div>
                
                {# ======================================== #}
                {# DELETE BUTTON (POST OWNER ONLY)      #}
                {# ======================================== #}
                {# Only show delete button if user is logged in AND is the post author #}
                {# This is a security feature - users can only delete their own posts #}
                {% if session.get('user_id') and session.get('user_id') == post.author_id %}
                <div class="mt-4 flex justify-end">
                    {# Form for deleting post - uses POST method for security #}
                    {# The action URL is generated dynamically using url_for() function #}
                    <form method="POST" action="{{ url_for('delete_post', slug=post.slug) }}" 
                          onsubmit="return confirm('Are you sure you want to delete this post? This action cannot be undone.')"
                          class="inline">
                        {# Delete button with red styling to indicate destructive action #}
                        <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center space-x-2">
                            {# Trash can icon SVG #}
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            <span>Delete Post</span>
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
            
            {# ======================================== #}
            {# POST TAGS                              #}
            {# ======================================== #}
            {# Display tags associated with this post #}
            {# Tags are clickable and filter posts by that tag #}
            {% if tags %}
            <div class="flex flex-wrap gap-2 mb-6">
                {# Loop through all tags for this post #}
                {# The for loop iterates over the tags list from the database #}
                {% for tag in tags %}
                {# Each tag is a clickable link that filters posts #}
                {# url_for('posts', tag=tag.name) generates a URL like /posts?tag=python #}
                <a href="{{ url_for('posts', tag=tag.name) }}" class="inline-block bg-gray-100 hover:bg-blog-100 text-gray-700 hover:text-blog-700 px-3 py-1 rounded-full text-sm font-medium transition-colors">
                    {# Display tag with # symbol - common social media convention #}
                    #{{ tag.name }}
                </a>
                {# End the for loop - this is required in Jinja #}
                {% endfor %}
            </div>
            {# End the if statement - only show tags section if tags exist #}
            {% endif %}
        </header>

        {# ======================================== #}
        {# POST CONTENT SECTION                    #}
        {# ======================================== #}
        {# This is the main article content area #}
        <article class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-gray-100">
            
            {# ======================================== #}
            {# FORMATTED CONTENT                      #}
            {# ======================================== #}
            {# Display the post content that has been processed by the format_content function #}
            {# The |safe filter allows HTML to render properly (be careful with user input!) #}
            {# prose-lg class provides typography styling for the content #}
            <div class="prose prose-lg max-w-none">
                {# This content comes from the Python format_content() function #}
                {# It converts markdown-style syntax to HTML for display #}
                {{ formatted_content | safe }}
            </div>
            
            {# ======================================== #}
            {# POST FOOTER                            #}
            {# ======================================== #}
            {# Contains metadata and share buttons #}
            <div class="mt-8 pt-6 border-t border-gray-200">
                <div class="flex items-center justify-between">
                    {# Last updated timestamp #}
                    <div class="text-sm text-gray-500">
                        {# Show last updated date with fallback to 'Recently' #}
                        Last updated: {{ post.updated_at if post.updated_at else 'Recently' }}
                    </div>
                    
                    {# ======================================== #}
                    {# SHARE BUTTONS                          #}
                    {# ======================================== #}
                    {# Social media sharing buttons (visual only in this demo) #}
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-500">Share:</span>
                        {# Twitter/X share button #}
                        <button class="text-gray-400 hover:text-blog-600 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                            </svg>
                        </button>
                        {# Facebook share button #}
                        <button class="text-gray-400 hover:text-blog-600 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                            </svg>
                        </button>
                        {# LinkedIn share button #}
                        <button class="text-gray-400 hover:text-blog-600 transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </article>

        {# ======================================== #}
        {# COMMENTS SECTION                        #}
        {# ======================================== #}
        {# This section handles all comment functionality #}
        <section class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-gray-100">
            
            {# ======================================== #}
            {# COMMENTS HEADER                       #}
            {# ======================================== #}
            {# Show comment count using the |length filter #}
            <h3 class="text-2xl font-display font-bold text-gray-800 mb-6">
                Comments ({{ comments|length }})
            </h3>
            
            {# ======================================== #}
            {# ADD COMMENT FORM                       #}
            {# ======================================== #}
            {# Only show comment form if user is logged in #}
            {# session.get('user_id') checks if user is authenticated #}
            {% if session.get('user_id') %}
            {# Form for submitting new comments #}
            <form method="POST" action="{{ url_for('add_comment', slug=post.slug) }}" class="mb-8">
                <div class="mb-4">
                    {# Label for accessibility #}
                    <label for="comment" class="block text-sm font-medium text-gray-700 mb-2">
                        Add a comment
                    </label>
                    {# Textarea for comment content #}
                    <textarea 
                        id="comment" 
                        name="content" 
                        required 
                        rows="4"
                        class="block w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blog-500 focus:border-blog-500 transition-colors resize-none"
                        placeholder="Share your thoughts on this post..."
                    ></textarea>
                </div>
                {# Submit button #}
                <button type="submit" class="bg-blog-600 hover:bg-blog-700 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                    Post Comment
                </button>
            </form>
            {% else %}
            {# ======================================== #}
            {# LOGIN PROMPT (for non-authenticated users) #}
            {# ======================================== #}
            {# Show login prompt if user is not logged in #}
            <div class="bg-gray-50 rounded-xl p-6 text-center mb-8">
                <p class="text-gray-600 mb-4">Join the conversation!</p>
                {# Link to login page #}
                <a href="{{ url_for('login') }}" class="bg-blog-600 hover:bg-blog-700 text-white px-6 py-3 rounded-xl font-medium transition-colors">
                    Login to Comment
                </a>
            </div>
            {% endif %}
            
            {# ======================================== #}
            {# COMMENTS LIST                         #}
            {# ======================================== #}
            {# Display all comments for this post #}
            {% if comments %}
            {# Container for all comments with spacing between them #}
            <div class="space-y-6">
                {# Loop through each comment - comments come from the database #}
                {% for comment in comments %}
                {# ======================================== #}
                {# INDIVIDUAL COMMENT ITEM              #}
                {# ======================================== #}
                <div class="border-l-4 border-blog-200 pl-6">
                    {# Comment header with user avatar and info #}
                    <div class="flex items-start space-x-3 mb-3">
                        {# User avatar - circular background with first letter of username #}
                        <div class="w-10 h-10 bg-blog-200 rounded-full flex items-center justify-center flex-shrink-0">
                            {# Get first character and make it uppercase #}
                            <span class="text-blog-700 font-semibold">{{ comment.username[0].upper() }}</span>
                        </div>
                        {# Comment content area #}
                        <div class="flex-1">
                            {# Username and timestamp #}
                            <div class="flex items-center space-x-2 mb-1">
                                <span class="font-semibold text-gray-800">{{ comment.username }}</span>
                                {# Show comment date with fallback #}
                                <span class="text-sm text-gray-500">{{ comment.created_at if comment.created_at else 'Recently' }}</span>
                            </div>
                            {# The actual comment text #}
                            <p class="text-gray-700 leading-relaxed">{{ comment.content }}</p>
                        </div>
                    </div>
                    
                    {# ======================================== #}
                    {# REPLY FORM (for logged-in users)        #}
                    {# ======================================== #}
                    {# Only show reply option if user is authenticated #}
                    {% if session.get('user_id') %}
                    <div class="ml-13">
                        {# Button to toggle reply form visibility #}
                        <button onclick="toggleReplyForm('reply-{{ comment.id }}')" class="text-sm text-blog-600 hover:text-blog-700 font-medium transition-colors">
                            Reply
                        </button>
                        
                        {# Hidden reply form that appears when Reply is clicked #}
                        {# Each comment gets a unique form ID using the comment ID #}
                        <form id="reply-{{ comment.id }}" method="POST" action="{{ url_for('add_comment', slug=post.slug) }}" class="hidden mt-3">
                            {# Hidden input to identify which comment this reply belongs to #}
                            <input type="hidden" name="parent_id" value="{{ comment.id }}">
                            <div class="flex space-x-3">
                                {# Reply textarea #}
                                <textarea 
                                    name="content" 
                                    required 
                                    rows="2"
                                    class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blog-500 focus:border-blog-500 transition-colors resize-none text-sm"
                                    placeholder="Write a reply..."
                                ></textarea>
                                {# Submit button for reply #}
                                <button type="submit" class="bg-blog-600 hover:bg-blog-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    Reply
                                </button>
                            </div>
                        </form>
                    </div>
                    {% endif %}
                    
                    {# ======================================== #}
                    {# REPLIES TO THIS COMMENT              #}
                    {# ======================================== #}
                    {# Show replies if this comment has any #}
                    {% if comment.replies %}
                    <div class="ml-13 mt-4 space-y-4">
                        {# Loop through all replies to this comment #}
                        {% for reply in comment.replies %}
                        {# Individual reply item with smaller styling #}
                        <div class="border-l-2 border-gray-200 pl-4">
                            <div class="flex items-start space-x-3">
                                {# Reply user avatar (smaller than main comment) #}
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-gray-600 text-sm font-semibold">{{ reply.username[0].upper() }}</span>
                                </div>
                                {# Reply content #}
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2 mb-1">
                                        <span class="font-semibold text-gray-800 text-sm">{{ reply.username }}</span>
                                        {# Reply timestamp #}
                                        <span class="text-xs text-gray-500">{{ reply.created_at if reply.created_at else 'Recently' }}</span>
                                    </div>
                                    {# Reply text #}
                                    <p class="text-gray-700 text-sm leading-relaxed">{{ reply.content }}</p>
                                </div>
                            </div>
                        </div>
                        {# End the reply loop #}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {# End the main comment loop #}
                {% endfor %}
            </div>
            {% else %}
            {# ======================================== #}
            {# NO COMMENTS MESSAGE                    #}
            {# ======================================== #}
            {# Show this message if there are no comments yet #}
            <div class="text-center py-8 text-gray-500">
                <p>No comments yet. Be the first to share your thoughts!</p>
            </div>
            {% endif %}
        </section>
    </div>
    
        {# ======================================== #}
    {# SIDEBAR (1 column)                       #}
    {# ======================================== #}
    {# Right sidebar with additional information and navigation #}
    <div class="lg:col-span-1">
        
        {# ======================================== #}
        {# AUTHOR CARD                             #}
        {# ======================================== #}
        {# Shows information about the post author #}
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6 border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">About the Author</h3>
            <div class="text-center">
                {# Author avatar - larger version than in the header #}
                <div class="w-20 h-20 bg-gradient-to-br from-blog-500 to-blog-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    {# First letter of author name in large text #}
                    <span class="text-white text-2xl font-bold">{{ post.author_name[0].upper() }}</span>
                </div>
                {# Author name #}
                <h4 class="font-semibold text-gray-800 mb-2">{{ post.author_name }}</h4>
                {# Author bio with fallback text #}
                {% if post.author_bio %}
                <p class="text-gray-600 text-sm leading-relaxed">{{ post.author_bio }}</p>
                {% else %}
                <p class="text-gray-500 text-sm">BlogSpace contributor</p>
                {% endif %}
            </div>
        </div>
        
        {# ======================================== #}
        {# RELATED POSTS                           #}
        {# ======================================== #}
        {# Show other posts in the same category #}
        {% if related_posts %}
        <div class="bg-white rounded-2xl shadow-md p-6 mb-6 border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Related Posts</h3>
            <div class="space-y-4">
                {# Loop through related posts #}
                {% for related_post in related_posts %}
                <div class="border-b border-gray-100 pb-3 last:border-b-0">
                    {# Link to related post #}
                    <a href="{{ url_for('view_post', slug=related_post.slug) }}" class="block hover:text-blog-600 transition-colors">
                        {# Related post title #}
                        <h4 class="font-medium text-gray-800 mb-1 line-clamp-2">{{ related_post.title }}</h4>
                        {# Related post author #}
                        <p class="text-sm text-gray-500">by {{ related_post.author_name }}</p>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {# ======================================== #}
        {# POST STATISTICS                         #}
        {# ======================================== #}
        {# Show various metrics about this post #}
        <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-100">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Post Statistics</h3>
            <div class="space-y-3">
                {# View count #}
                <div class="flex justify-between">
                    <span class="text-gray-600">Views</span>
                    <span class="font-semibold text-gray-800">{{ post.view_count }}</span>
                </div>
                {# Comment count #}
                <div class="flex justify-between">
                    <span class="text-gray-600">Comments</span>
                    {# Use |length filter to count comments #}
                    <span class="font-semibold text-gray-800">{{ comments|length }}</span>
                </div>
                {# Publication date #}
                <div class="flex justify-between">
                    <span class="text-gray-600">Published</span>
                    <span class="font-semibold text-gray-800">{{ post.created_at if post.created_at else 'Recently' }}</span>
                </div>
            </div>
        </div>
    </div>
</div>

{# ======================================== #}
{# JAVASCRIPT FUNCTIONALITY                 #}
{# ======================================== #}
{# JavaScript for toggling reply forms on/off #}
<script>
{# Function to show/hide reply forms when Reply button is clicked #}
function toggleReplyForm(formId) {
    {# Get the form element by its ID #}
    const form = document.getElementById(formId);
    {# Check if form is currently hidden #}
    if (form.classList.contains('hidden')) {
        {# Show the form by removing the 'hidden' class #}
        form.classList.remove('hidden');
    } else {
        {# Hide the form by adding the 'hidden' class #}
        form.classList.add('hidden');
    }
}
</script>

{# ======================================== #}
{# STUDENT LEARNING NOTES                   #}
{# ======================================== #}
{# This template demonstrates many important Flask and Jinja concepts #}

{# TEMPLATE STRUCTURE AND INHERITANCE: #}
{# - This template extends base.html using {% extends "base.html" %} #}
{# - The {% block content %} section gets inserted into base.html #}
{# - This allows consistent navigation, styling, and layout across all pages #}

{# JINJA SYNTAX EXAMPLES: #}
{# - {{ post.title }} - Display post title from database #}
{# - {{ formatted_content | safe }} - Display HTML content safely (the |safe filter is important!) #}
{# - {% if comments %} - Conditional rendering (only show if comments exist) #}
{# - {% for comment in comments %} - Loop through all comments #}
{# - {% if session.get('user_id') %} - Check if user is logged in #}

{# CONDITIONAL RENDERING: #}
{# - {% if post.category_name %} - Only show category if it exists #}
{# - {% if post.author_bio %} - Only show bio if it exists #}
{# - {% if comment.replies %} - Only show replies section if there are replies #}

{# LOOPING THROUGH DATA: #}
{# - {% for comment in comments %} - Loop through all comments #}
{# - {% for reply in comment.replies %} - Nested loop for replies #}
{# - {% for tag in tags %} - Loop through post tags #}

{# FILTERS: #}
{# - {{ post.title[:30] }} - String slicing (first 30 characters) #}
{# - {{ comments|length }} - Count the number of comments #}
{# - {{ post.created_at if post.created_at else 'Recently' }} - Conditional with fallback #}

{# URL GENERATION: #}
{# - {{ url_for('index') }} - Generate URL for home page #}
{# - {{ url_for('posts') }} - Generate URL for posts list #}
{# - {{ url_for('view_post', slug=post.slug) }} - Generate URL with parameters #}

{# SESSION MANAGEMENT: #}
{# - session.get('user_id') - Get user ID from Flask session #}
{# - session.get('is_admin') - Check if user is admin #}

{# FORM HANDLING: #}
{# - method="POST" - Form submission method #}
{# - action="{{ url_for('add_comment', slug=post.slug) }}" - Where form data goes #}
{# - onsubmit="return confirm('...')" - JavaScript confirmation dialog #}

{# RESPONSIVE DESIGN: #}
{# - grid grid-cols-1 lg:grid-cols-4 - 1 column on mobile, 4 on large screens #}
{# - lg:col-span-3 - Main content takes 3 columns on large screens #}
{# - lg:col-span-1 - Sidebar takes 1 column on large screens #}

{# SECURITY FEATURES: #}
{# - Only post authors can see delete button #}
{# - User authentication required for commenting #}
{# - POST method for destructive actions (delete) #}

{# DATA RELATIONSHIPS: #}
{# - post.author_id links to users table #}
{# - comment.post_id links to posts table #}
{# - comment.parent_id creates nested comment structure #}

{# ACCESSIBILITY: #}
{# - Proper heading hierarchy (h1, h2, h3) #}
{# - Labels for form inputs #}
{# - Semantic HTML structure #}
{# - Clear visual feedback and navigation #}

{# CONTENT ORGANIZATION: #}
{# - Breadcrumb navigation for user orientation #}
{# - Logical content flow: header ‚Üí content ‚Üí comments #}
{# - Sidebar with relevant contextual information #}
{# - Clear separation between different content types #}

{# JAVASCRIPT INTEGRATION: #}
{# - Alpine.js for interactive components #}
{# - Custom functions for form toggling #}
{# - Event handlers for user interactions #}

{# TAILWIND CSS CLASSES: #}
{# - bg-white, rounded-2xl, shadow-lg - Card styling #}
{# - text-blog-600, hover:text-blog-700 - Custom color scheme #}
{# - flex, grid, space-y-6 - Layout utilities #}
{# - transition-colors - Smooth hover effects #}

{# This template shows how Flask can create rich, interactive web pages #}
{# with proper separation of concerns, security, and user experience #}
{% endblock %}

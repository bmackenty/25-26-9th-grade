{% extends "base.html" %}

{% block title %}Home - Threaded Discussion Board{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-white rounded-lg shadow-md p-6 text-center">
        <div class="text-3xl font-bold text-blue-600">{{ stats.threads }}</div>
        <div class="text-gray-600">Total Threads</div>
    </div>
    <div class="bg-white rounded-lg shadow-md p-6 text-center">
        <div class="text-3xl font-bold text-green-600">{{ stats.users }}</div>
        <div class="text-gray-600">Registered Users</div>
    </div>
    <div class="bg-white rounded-lg shadow-md p-6 text-center">
        <div class="text-3xl font-bold text-purple-600">{{ stats.posts }}</div>
        <div class="text-gray-600">Total Posts</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <div class="flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
        <h2 class="text-xl font-semibold text-gray-800">Quick Actions</h2>
        <div class="flex space-x-4">
            <a href="{{ url_for('create_thread') }}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                Create New Thread
            </a>
            <a href="{{ url_for('export_csv') }}" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                Export Data
            </a>
        </div>
    </div>
</div>

<!-- Filters and Search -->
<div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <form method="GET" action="{{ url_for('index') }}" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <!-- Search -->
            <div>
                <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                <input type="text" id="search" name="search" value="{{ search }}" 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Search threads...">
            </div>
            
            <!-- Category Filter -->
            <div>
                <label for="category" class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                <select id="category" name="category" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">All Categories</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if selected_category == category.id %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <!-- Sort By -->
            <div>
                <label for="sort" class="block text-sm font-medium text-gray-700 mb-2">Sort By</label>
                <select id="sort" name="sort" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="latest" {% if selected_sort == 'latest' %}selected{% endif %}>Latest</option>
                    <option value="oldest" {% if selected_sort == 'oldest' %}selected{% endif %}>Oldest</option>
                    <option value="most_viewed" {% if selected_sort == 'most_viewed' %}selected{% endif %}>Most Viewed</option>
                    <option value="most_replied" {% if selected_sort == 'most_replied' %}selected{% endif %}>Most Replied</option>
                    <option value="most_voted" {% if selected_sort == 'most_voted' %}selected{% endif %}>Most Voted</option>
                </select>
            </div>
            
            <!-- Apply Button -->
            <div class="flex items-end">
                <button type="submit" class="w-full bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md transition-colors">
                    Apply Filters
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Threads List -->
<div class="bg-white rounded-lg shadow-md">
    <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-800">
            {% if search %}Search Results for "{{ search }}"{% else %}All Threads{% endif %}
            {% if selected_category %}
                in {{ categories|selectattr('id', 'equalto', selected_category)|first|attr('name') }}
            {% endif %}
        </h2>
    </div>
    
    {% if threads %}
        <div class="divide-y divide-gray-200">
            {% for thread in threads %}
                <div class="p-6 hover:bg-gray-50 transition-colors">
                    <div class="flex items-start space-x-4">
                        <!-- Vote Buttons -->
                        <div class="flex flex-col items-center space-y-2">
                            <button onclick="vote('thread', {{ thread.id }}, 'upvote')" 
                                    class="text-gray-400 hover:text-green-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                                </svg>
                            </button>
                            <span class="text-lg font-semibold text-gray-700">{{ thread.vote_score or 0 }}</span>
                            <button onclick="vote('thread', {{ thread.id }}, 'downvote')" 
                                    class="text-gray-400 hover:text-red-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Thread Content -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2 mb-2">
                                <h3 class="text-lg font-semibold text-gray-900 hover:text-blue-600">
                                    <a href="{{ url_for('view_thread', thread_id=thread.id) }}">
                                        {% if thread.is_pinned %}ðŸ“Œ {% endif %}
                                        {% if thread.is_locked %}ðŸ”’ {% endif %}
                                        {{ thread.title }}
                                    </a>
                                </h3>
                            </div>
                            
                            <div class="text-gray-600 mb-3 line-clamp-2">
                                {{ thread.content[:200] }}{% if thread.content|length > 200 %}...{% endif %}
                            </div>
                            
                            <div class="flex items-center space-x-4 text-sm text-gray-500">
                                <span>by <span class="font-medium text-gray-700">{{ thread.username }}</span></span>
                                <span>in <span class="font-medium text-gray-700">{{ thread.category_name }}</span></span>
                                <span>{{ thread.created_at.split(' ')[0] }}</span>
                                <span>{{ thread.reply_count }} replies</span>
                                <span>{{ thread.view_count }} views</span>
                            </div>
                        </div>
                        
                        <!-- Like Button -->
                        <div class="flex flex-col items-center">
                            <button onclick="like('thread', {{ thread.id }})" 
                                    class="text-gray-400 hover:text-red-500 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="p-12 text-center">
            <div class="text-gray-400 mb-4">
                <svg class="mx-auto h-12 w-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No threads found</h3>
            <p class="text-gray-500 mb-6">
                {% if search or selected_category %}
                    Try adjusting your search criteria or filters.
                {% else %}
                    Be the first to start a conversation!
                {% endif %}
            </p>
            <a href="{{ url_for('create_thread') }}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                Create New Thread
            </a>
        </div>
    {% endif %}
</div>

<script>
function vote(type, itemId, voteType) {
    fetch(`/vote/${type}/${itemId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `vote_type=${voteType}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

function like(type, itemId) {
    fetch(`/like/${type}/${itemId}`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
    });
}
</script>
{% endblock %}
